name: 'Create ServiceNow Change Request'
description: 'Creates a ServiceNow Change Request (Normal or Standard).'
outputs:
  command: 
    description: "INPUT_DESCRIPTION"
    value: ${{ steps.cr.outputs.command }}
  http_code: 
    description: "INPUT_DESCRIPTION"
    value: ${{ steps.cr.outputs.http_code }}
runs:
  using: "composite"
  steps:
    - shell: bash
      id: cr
      run: |
        ENDPOINT=https://google.com
        AUTH_HEADER=abc:123                        
        INPUT_SHORT_DESCRIPTION=test
        INPUT_DESCRIPTION="\"\ttest \"ali\"\n"
        INPUT_ASSIGNMENT_GROUP=test
        INPUT_REQUESTED_BY=test
        CURL_CMD=$(cat <<EOF
        curl -s -w "%{http_code}" -o response.json \
          -X POST "$ENDPOINT" \
          -H "Content-Type: application/json" \
          -H "Authorization: Basic $AUTH_HEADER" \
          -d '{ \
            "short_description": "$INPUT_SHORT_DESCRIPTION", \
            "description": "$INPUT_DESCRIPTION", \
            "assignment_group": "$INPUT_ASSIGNMENT_GROUP", \
            "requested_by": "$INPUT_REQUESTED_BY" \
          }'
        EOF
        )
        RES=$(eval "$CURL_CMD")
        HTTP_CODE=$(tail -c 4 <<< "$RES")
        echo $HTTP_CODE
        echo =================================
        cat response.json
        echo =================================
        curl --version
        echo "http_code=$HTTP_CODE" >> $GITHUB_OUTPUT
        echo "command=$CURL_CMD" >> $GITHUB_OUTPUT





